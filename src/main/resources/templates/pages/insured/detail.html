<!DOCTYPE html>
<html lang="cs-cz" xmlns:th="http://www.thymeleaf.org">
  <head th:replace="~{fragments/layout.html :: head}">

  </head>
  <body class="custom-body">
  <header th:replace="~{fragments/layout.html :: header}"></header>

  <div class="py-2 flash-message message-error" th:text="${error}" th:if="${error}"></div>
  <div class="py-2 flash-message message-success" th:text="${success}" th:if="${success}"></div>

    <article class="container">
      <header class="mb-5 text-center">
        <div class="card mb-5" style="width: 75vh">
          <div class="card-body d-flex">
            <h2 class="card-title">
              <span th:text="${user.firstName} + ' ' + ${user.lastName}"></span>
            </h2>
            <p class="card-subtitle mb-2">
              <span class="badge text-bg-dark ms-2" th:each="role : ${user.roles}" th:text="${role.getFormattedRole()}"></span>
            </p>
            <p class="card-text text-muted" th:text="${user.street}"></p>
            <p class="card-text text-muted" th:text="${user.city}"></p>
            <p class="card-text text-muted" th:text="${user.zipCode}"></p>
          </div>
          <div class="col">
            <p class="card-text text-muted" th:text="${user.email}"></p>
            <p class="card-text text-muted" th:text="${user.phone}"></p>
          </div>
        </div>

      </header>

      <section class="text-center mb-5">
        <h2 class="mb-4" th:text="${policies.size() == 0 ? 'Žádná pojištění' : 'Sjednaná pojištění'}"></h2>

        <table class="table table-striped table-hover" th:if="${policies.size() > 0}">
          <thead>
          <tr>
            <th>Pojištění</th>
            <th>Částka</th>
            <th>Pojištěný</th>
            <th></th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="policy: ${policies}">
            <td><a th:href="@{'/policy/' + ${policy.policyId} + '/detail'}"
                   th:text="${policy.type != null ? policy.type.getFormattedPolicyType() : 'Neznámý typ pojištění'}"></a></td>
            <td th:text="${policy.coverageAmount}"></td>
            <td th:text="${policy.insuredUser.firstName} + ' ' + ${policy.insuredUser.lastName}"></td>
            <td>
              <a class="btn btn-warning btn-sm" th:href="@{'/policy/' + ${policy.policyId} + '/edit'}">Editovat</a>
              <a class="btn btn-danger btn-sm" th:href="@{'/policy/' + ${policy.policyId} + '/delete'}">Odstranit</a>
            </td>
          </tr>
          </tbody>
        </table>
        <!-- Pagination -->
        <div class="pagination-container text-center">
          <nav>
            <ul class="pagination" th:if="${totalPages > 1}">
              <li class="page-item" th:class="${currentPage == 1 ? 'disabled' : ''}">
                <a class="page-link" href="#" th:href="@{/policy(page=${currentPage - 1})}">Předchozí</a>
              </li>

              <!-- Loop through the page numbers -->
              <li class="page-item" th:each="pageNum : ${#numbers.sequence(1, totalPages)}" th:class="${pageNum == currentPage ? 'active' : ''}">
                <a class="page-link" th:href="@{/policy(page=${pageNum})}" th:text="${pageNum}"></a>
              </li>

              <li class="page-item" th:class="${currentPage == totalPages ? 'disabled' : ''}">
                <a class="page-link" href="#" th:href="@{/policy(page=${currentPage + 1})}">Další</a>
              </li>
            </ul>
          </nav>
        </div>

        <a class="btn btn-primary" th:href="@{'/policy/' + ${userId} + '/create'}">Přidat pojištění</a>
        <a class="btn btn-warning" th:href="@{'/insured/' + ${user.userId} + '/edit'}">Editovat pojištěnce</a>
        <a class="btn btn-danger" th:href="@{'/insured/' + ${user.userId} + '/delete'}">Odstranit pojištěnce</a>
        <a class="btn btn-dark" th:href="@{/insured}">Zpět na seznam</a>

      </section>
    </article>
    <footer th:replace="~{fragments/layout.html :: footer}"></footer>
  </body>
</html>